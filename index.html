<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Crash Data: Time, Location, and Factors</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <!-- Playful Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
  <!-- App styles -->
  <link rel="stylesheet" href="css/styles.css" />
  <!-- D3 -->
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <!-- Leaflet CSS & JS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
</head>
<body>
  <!-- Hero -->
  <header class="hero py-5 text-center reveal" data-reveal-delay="0">
    <div class="container">
      <h1 class="display-4 hero-title">Crash Data</h1>
      <p class="lead hero-tagline mb-3">This page is a small map of choices. The data uses the full NYC crash records provided in this repository. The visuals are simple. The goal is clarity. The intent is action.</p>
      <p class="subtitle">Data: data/original/collisions_severity.csv</p>
      <p class="subtitle">Authors: Felix Wu; Benjamin He; Andrew Hu</p>
    </div>
  </header>

  <!-- Quick Risk Snapshot 1: Day of week -->
  <section class="py-5 section-card reveal" data-reveal-delay="30">
    <div class="container">
      <h2 class="section-title mb-2">Risk by day of week</h2>
      <p class="section-copy small mb-3">
        What this shows: the empirically shrunk injury rate for crashes on each day of the week, with a dashed line for the overall dataset baseline.
        Method: we compute the share of crashes with any injury for each day and apply a binomial empirical‑Bayes prior (k = 50) so small-sample days don’t jump around.
        Read it as relative risk: bars above the dashed line indicate riskier-than-average days.
      </p>
      <div class="chart-card p-2 p-md-3">
        <div class="chart-title">Most dangerous day of week</div>
        <div id="viz-dow" class="chart-wrap" style="height:52vh; min-height:420px;" aria-label="Bar chart of empirically shrunk injury rate by day of week"></div>
      </div>
    </div>
  </section>

  <!-- Quick Risk Snapshot 2: Vehicle type -->
  <section class="py-5 section-card alt reveal" data-reveal-delay="45">
    <div class="container">
      <h2 class="section-title mb-2">Risk by vehicle type</h2>
      <p class="section-copy small mb-3">
        What this shows: the injury rate for the most common vehicle types, stabilized with empirical‑Bayes shrinkage and compared to the dataset baseline (dashed line).
        Method: we rank vehicle types by frequency, keep the top groups, and compute the EB‑shrunk injury proportion per type. This avoids over‑interpreting rare categories.
        Interpretation: bars to the right of baseline are relatively more dangerous; to the left are safer, all else equal.
      </p>
      <div class="chart-card p-2 p-md-3">
        <div class="chart-title">Most dangerous vehicle type</div>
        <div id="viz-vehicle" class="chart-wrap" style="height:52vh; min-height:420px;" aria-label="Bar chart of empirically shrunk injury rate by vehicle type"></div>
      </div>
    </div>
  </section>

  <!-- Quick Risk Snapshot 3: Driver sex -->
  <section class="py-5 section-card reveal" data-reveal-delay="60">
    <div class="container">
      <h2 class="section-title mb-2">Male vs female drivers</h2>
      <p class="section-copy small mb-3">
        What this shows: empirically shrunk injury rates by recorded driver sex compared to the dataset baseline. Categories include Male, Female, and Other/Unknown when present.
        Method: binomial empirical‑Bayes shrinkage (k = 50) applied to each group; the dashed line marks the overall mean.
        Reading the chart: higher bars indicate higher likelihood of injury involvement among crashes attributed to that driver group.
      </p>
      <div class="chart-card p-2 p-md-3">
        <div class="chart-title">Male vs female drivers</div>
        <div id="viz-gender" class="chart-wrap" style="height:52vh; min-height:420px;" aria-label="Bar chart comparing injury rate for male vs female drivers with EB shrinkage"></div>
      </div>
    </div>
  </section>

  <!-- Chapter 1: Place → See where risk lives -->
  <section class="py-5 section-card alt reveal" data-reveal-delay="60">
    <div class="container">
      <div class="row align-items-start g-4 flex-lg-row-reverse">
        <div class="col-lg-5">
          <div class="chapter-label">Chapter 1 · Place</div>
          <h2 class="section-title">See where risk lives</h2>
          <p class="section-copy">Methods and findings: We parse LOCATION strings into latitude/longitude and CRASH_TIME into an integer hour (0–23), discarding rows with invalid or missing values. Points are rendered on a Leaflet map (Web Mercator) over OpenStreetMap tiles using canvas-based circle markers with fixed 1 px radius and red fill; symbol size is constant in screen pixels across zoom levels. The Hour slider filters points by exact hour equality on the client. This view exposes spatial concentration: collisions cluster along dense arterials and Manhattan’s core, with visible corridors along major avenues and expressway interchanges. When selecting peak commuting hours, the spatial footprint broadens and intensifies on trunk routes; overnight selections reveal sparse, localized activity.</p>
        </div>
        <div class="col-lg-7">
          <div class="chart-card p-2 p-md-3">
            <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-2">
              <div class="chart-title m-0">Accident Locations on Streets (Dots)</div>
              <div class="d-flex align-items-center gap-2" aria-label="Filter crashes by hour">
                <label for="hour-slider" class="form-label mb-0">Hour:</label>
                <input id="hour-slider" type="range" min="0" max="23" step="1" value="0" class="form-range" style="width:180px" aria-valuemin="0" aria-valuemax="23" aria-valuenow="0" aria-label="Hour of day slider">
                <output id="hour-label" for="hour-slider" class="badge bg-secondary" aria-live="polite">00:00</output>
              </div>
            </div>
            <div id="leaflet-map" class="chart-wrap" style="height:60vh;" aria-label="Leaflet basemap of New York City with crash dots filtered by selected hour"></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Chapter 2: Time → Find calmer hours -->
  <section class="py-5 section-card reveal" data-reveal-delay="120">
    <div class="container">
      <div class="row align-items-start g-4">
        <div class="col-lg-5">
          <div class="chapter-label">Chapter 2 · Time</div>
          <h2 class="section-title">Find calmer hours</h2>
          <p class="section-copy">Methods and findings: We bin collisions by calendar month (columns) and hour of day (rows) to form a Month×Hour matrix. Counts are simple frequencies per cell computed from parsed CRASH_DATE and CRASH_TIME fields after dropping invalid records. The color scale is percentile-normalized over the visible window to reduce the effect of extreme cells; this emphasizes relative intensity patterns rather than absolute magnitudes. Panning/zooming the time axis recomputes the domain; row order can be cycled for comparison. The matrix shows clear diurnal structure: minima between ~02:00–05:00; pronounced AM (~07:00–10:00) and PM (~16:00–19:00) peaks on weekdays; flatter profiles on weekends; and a visible level shift downward from 2020 onward consistent with pandemic-era traffic reductions.</p>
        </div>
        <div class="col-lg-7">
          <div class="chart-card p-2 p-md-3">
            <div class="chart-title">Temporal Heatmap (Month × Hour)</div>
            <div id="chart" class="chart-wrap" aria-label="Temporal heatmap showing collisions per month and hour"></div>
            <div id="chart-legend" class="legend-wrap mt-2" aria-label="Legend for temporal heatmap"></div>
            <div id="time-insight" class="mt-2 small text-muted" aria-live="polite"></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Chapter 3: Why → Choose better defaults -->
  <section class="py-5 section-card reveal" data-reveal-delay="180">
    <div class="container">
      <div class="row align-items-start g-4">
        <div class="col-lg-5">
          <div class="chapter-label">Chapter 3 · Why</div>
          <h2 class="section-title">Choose better defaults</h2>
          <p class="section-copy">This chart ranks conditions linked to injury. The score comes from a chi‑square test. The color shows risk ratio. Read the leaders. Pick one habit to shift. Small, repeatable choices add up.</p>
        </div>
        <div class="col-lg-7">
          <div class="chart-card p-2 p-md-3 mb-3">
            <div class="chart-title">Most explanatory factors (injury likelihood)</div>
            <div id="factors" class="chart-wrap" style="height:60vh;" aria-label="Bar chart of most significant factors by chi-square score"></div>
            <div id="factors-legend" class="legend-wrap mt-2" aria-label="Legend for factors chart"></div>
          </div>
          <div class="chart-card p-2 p-md-3">
            <div class="chart-title">Personalized risk estimator</div>
            <form id="smart-form" class="row g-3 align-items-end" aria-label="Select conditions to estimate injury likelihood">
              <div class="col-sm-6 col-md-4">
                <label for="sf-action" class="form-label">What was your car doing?</label>
                <select id="sf-action" class="form-select" aria-label="Pre-crash action select">
                  <option value="">Any</option>
                </select>
              </div>
              <div class="col-sm-6 col-md-4">
                <label for="sf-vehicle" class="form-label">Vehicle type</label>
                <select id="sf-vehicle" class="form-select" aria-label="Vehicle type select">
                  <option value="">Any</option>
                </select>
              </div>
              <div class="col-sm-6 col-md-4">
                <label for="sf-gender" class="form-label">Driver gender</label>
                <select id="sf-gender" class="form-select" aria-label="Driver gender select">
                  <option value="">Any</option>
                </select>
              </div>
              <div class="col-sm-6 col-md-4">
                <label for="sf-hour" class="form-label">Hour</label>
                <select id="sf-hour" class="form-select" aria-label="Hour of day select">
                  <option value="">Any</option>
                </select>
              </div>
              <div class="col-sm-6 col-md-4">
                <label for="sf-factor1" class="form-label">Contributing factor</label>
                <select id="sf-factor1" class="form-select" aria-label="Contributing factor select">
                  <option value="">Any</option>
                </select>
              </div>
              <div class="col-12">
                <output id="smart-results" class="alert alert-info mb-0" role="status" aria-live="polite">Pick options to see estimated injury likelihood.</output>
              </div>
              <div class="col-12">
                <div id="smart-chart" class="mt-3" style="height:140px;" aria-label="Bar chart comparing your estimated injury risk to baseline"></div>
              </div>
            </form>
            <p id="smart-methods" class="section-copy small mt-2">
              Statistical notes: We estimate injury likelihood using two layers. (1) Exact-match estimate: a binomial proportion for the records matching your selections, stabilized with empirical‑Bayes shrinkage toward the overall dataset mean (prior weight k = 50). (2) Backoff estimate: when there are few or no identical cases, we combine marginal evidence from each selected factor (borough, hour, action, vehicle, driver sex, contributing factor) using a Naive‑Bayes‑style odds product relative to the global baseline, with per‑factor odds ratios themselves empirically shrunk. We cap extreme per‑factor effects and blend the exact and backoff estimates based on the matched sample size. Reported relative risk is vs the overall baseline. Categories marked “Any” are not filtered.
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Call to action -->
  <section class="py-5 section-card cta reveal" data-reveal-delay="240">
    <div class="container text-center">
      <h2 class="section-title mb-2">Make one change this week</h2>
      <p class="section-copy mb-4">Pick a safer hour. Pick a calmer route. Share one insight.</p>
      <div class="d-flex justify-content-center gap-3 flex-wrap">
        <a class="btn btn-lg btn-cta" href="#chart">Shift my commute time</a>
        <a class="btn btn-lg btn-cta alt" href="#leaflet-map">Reroute around hotspots</a>
        <a class="btn btn-lg btn-cta" href="#factors">Review top risk factors</a>
      </div>
    </div>
  </section>


  <!-- Methods Section -->
  <section class="py-5 section-card alt reveal" data-reveal-delay="360">
    <div class="container">
      <div class="row g-4">
        <div class="col-12">
          <h2 class="section-title">Methods</h2>
          <p class="section-copy">
            We use the full dataset. We parse dates, times, and coordinates. We drop invalid or missing values.
          </p>
          <p class="section-copy">
            The heatmap aggregates monthly counts by hour. The color scale uses percentiles within the visible window. Horizontal zoom adjusts the time window. Vertical scroll cycles the hour order.
          </p>
          <p class="section-copy">
            The map fits inlier points with a Mercator projection. Identical coordinates separate with deterministic jitter. Far outliers are trimmed by quantiles. The density overlay uses percentile normalization. Point size stays constant while you zoom.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Closing note -->
  <section class="py-5 text-center closing reveal" data-reveal-delay="420">
    <div class="container">
      <p class="closing-line mb-1">Information matters when it becomes a habit.</p>
      <p class="closing-sub">Pick one change. Try it this week. Share the result.</p>
    </div>
  </section>

  <div id="tooltip" class="tooltip"></div>

  <!-- Scroll reveal for sections (lightweight, accessible) -->
  <script>
    (function() {
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      const els = document.querySelectorAll('.reveal');
      if (prefersReduced) {
        els.forEach(el => el.classList.add('in-view'));
        return;
      }
      const io = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const delay = parseInt(entry.target.getAttribute('data-reveal-delay') || '0', 10);
            setTimeout(() => entry.target.classList.add('in-view'), delay);
            io.unobserve(entry.target);
          }
        });
      }, { threshold: 0.1 });
      els.forEach(el => io.observe(el));
    })();
  </script>

  <script type="module" src="js/main.js"></script>
  <!-- Bootstrap JS (optional, no jQuery needed) Test -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>
